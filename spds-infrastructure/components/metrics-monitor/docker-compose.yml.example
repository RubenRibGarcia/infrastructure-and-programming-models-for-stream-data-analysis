version: "3.7"

services:
  influxdb:
    image: influxdb:1.8-alpine
    container_name: influxdb
    restart: on-failure
    ports:
      - "8086:8086"
    environment:
      - INFLUXDB_DB=telegraf
      - INFLUXDB_HTTP_AUTH_ENABLED=true
      - INFLUXDB_ADMIN_USER=administrator
      - INFLUXDB_ADMIN_PASSWORD=password
      - INFLUXDB_USER=telegraf
      - INFLUXDB_USER_PASSWORD=password
    volumes:
      - "$PWD/spds-metrics-monitorization/metrics-monitor/influxdb:/var/lib/influxdb"

  grafana:
    image: grafana/grafana:6.7.2
    container_name: grafana
    restart: on-failure
    user: "root"
    ports:
      - "3000:3000"
    volumes:
      - "$PWD/spds-metrics-monitorization/metrics-monitor/grafana:/var/lib/grafana"

  telegraf:
    image: telegraf:1.14-alpine
    container_name: telegraf
    restart: on-failure
    ports:
      - "8125:8125/udp"
    volumes:
      - "$PWD/spds-metrics-monitorization/metrics-agent/configs/telegraf.conf:/etc/telegraf/telegraf.conf:ro"

networks:
  default:
    external:
      name: spds-network
